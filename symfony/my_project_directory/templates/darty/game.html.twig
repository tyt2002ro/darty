<!DOCTYPE html>

<title>Hello GameController!</title>

<link href="{{ asset('css/game.css') }}" rel="stylesheet">
<link href="{{ asset('css/popup.css') }}" rel="stylesheet">

{% block body %}

    <div class="wrapper">

        {% for notice in app.flashes('notice') %}
            <div class="notice-container">
                {{ notice }}
            </div>
        {% endfor %}



        <div class="row">
            <div class="left-container">
                <div class="row">
                    <div class="cell cell-3">Game Type: {% if gameType|length > 0 %}{{ gameType }}{% endif %}</div>
                    <div class="cell cell-3">Finish: {% if gameEndType|length > 0 %}{{ gameEndType }}{% endif %}</div>
                    <div class="cell cell-3">Leg {% if mainPlayerData.legThrows|length > 0 %}{{ 3-mainPlayerData.legThrows }}{% endif %}
                        /3
                    </div>
                </div>
                <div class="row">
                    <div class="cell cell-4">Name: {% if mainPlayerData.name|length > 0 %}{{ mainPlayerData.name }}{% endif %}</div>
                    <div class="cell cell-4">Bull</div>
                    <div class="cell cell-4">20</div>
                    <div class="cell cell-4">{% if mainPlayerData.legThrows|length > 0 %}{{ 3-mainPlayerData.legThrows }}{% endif %}</div>
                </div>
                <div class="row">
                    <div class="cell cell-4 cell-fixed-height cell-padding-top">Points: <span id="points">{% if mainPlayerData.pointsTotal|length > 0 %}{{ mainPlayerData.pointsTotal }}{% endif %}</span></div>
                    <div class="cell cell-4 cell-fixed-height cell-padding-top">0 S
                    </div>
                    <div class="cell cell-4 cell-fixed-height cell-padding-top">Throws
                        left: {% if mainPlayerData.legThrows|length > 0 %}{{ mainPlayerData.legThrows }}{% endif %}
                        <img src="{{ asset('images/darts_arrow.png') }}" alt="darts arrow" class="image"/>
                    </div>
                    <div class="cell cell-4 cell-fixed-height cell-padding-top">5
                    </div>
                </div>
                <div class="row">
                    <div class="cell cell-4">
                        Average: {% if mainPlayerData.pointsAverage|length > 0 %}{{ mainPlayerData.pointsAverage }}{% endif %}</div>
                    <div class="cell cell-4">Left: <span
                                id="pointsleft">{% if (endGamePointsRequired|length > 0) %}{{ endGamePointsRequired }}{% endif %}</span>
                    </div>

                    <div class="cell cell-4">{% if (mainPlayerData.endGameThrowDoubleSuggestion|length > 0) %} End combination: <span
                                id="pointsleft">{{ mainPlayerData.endGameThrowDoubleSuggestion }}</span>
                        {% endif %}
                    </div>
                    <div class="cell cell-4">-</div>
                </div>
            </div>
            <div class="right-container">
                {% if otherPlayersData|length > 0 %}
                    {% for otherPlayerData in otherPlayersData %}
                        <div class="cell cell-1 cell-title">{{ otherPlayerData.name }}</div>
                        <div class="cell cell-2">{{ otherPlayerData.pointsTotal }}</div>
                        <div class="cell cell-2">{{ otherPlayerData.pointsAverage }}</div>
                    {% endfor %}
                {% endif %}
            </div>
        </div>
        <div class="buttons-container">
            <div class="row">

                <label for="single">
                    <input type="radio" id="single" name="optionPoints"
                           value="single" checked="checked" onclick="setMultipleValue(1);">Single
                </label><br>
                <label for="double">
                    <input type="radio" id="double" name="optionPoints"
                           value="double" onclick="setMultipleValue(2);">Double
                </label><br>
                <label for="triple">
                    <input type="radio" id="triple" name="optionPoints"
                           value="triple" onclick="setMultipleValue(3);">Triple
                </label><br>
            </div>

            {% for i in 0..6 %}
                <div class="row">
                    {% for j in 1..3 %}
                        {% if (3 * i + j) != 21 %}
                            <form method="POST" action="/add/throw/{{ game_id }}/{{ player_id }}">
                                <input type="hidden" name="player_id" value="{{ player_id }}">
                                <input type="hidden" name="game_id" value="{{ game_id }}">
                                <input type="hidden" name="points" value="{{ 3 * i + j }}">
                                <input type="hidden" name="double" class="doubleOption" value="">
                                <input type="hidden" name="triple" class="tripleOption" value="">
                                <button type="submit" class="button  button-small"
                                        id="{{ 3 * i + j }}">{{ 3 * i + j }}</button>
                            </form>
                        {% else %}
                            <form method="POST" action="/add/throw/{{ game_id }}/{{ player_id }}">
                                <input type="hidden" name="player_id" value="{{ player_id }}">
                                <input type="hidden" name="game_id" value="{{ game_id }}">
                                <input type="hidden" name="points" value="25">
                                <input type="hidden" name="double" class="doubleOption" value="">
                                <input type="hidden" name="triple" class="tripleOption" value="">
                                <button type="submit" class="button  button-small"
                                        id="25">25
                                </button>
                            </form>
                        {% endif %}
                    {% endfor %}
                </div>
            {% endfor %}

            <div class="row">
                <form method="POST" action="/add/throw/{{ game_id }}/{{ player_id }}">
                    <input type="hidden" name="player_id" value="{{ player_id }}">
                    <input type="hidden" name="game_id" value="{{ game_id }}">
                    <input type="hidden" name="points" value="0">
                    <input type="hidden" name="double" class="doubleOption" value="">
                    <input type="hidden" name="triple" class="tripleOption" value="">
                    <button type="submit" class="button  button-large" id="0">Daneben</button>
                </form>
                <form method="POST" action="/undo/throw/{{ game_id }}/{{ player_id }}">
                    <input type="hidden" name="player_id" value="{{ player_id }}">
                    <input type="hidden" name="game_id" value="{{ game_id }}">
                    <button type="submit" class="button  button-large" id="undoButton" onclick="return confirm('Are you sure you want to undo last throw ?');">Undo</button>
                </form>
            </div>
        </div>
    </div>

    <div id="myModal" class="modal">
        <div class="modal-content">
            <p class="success-message"></p>
            <button type="button" id="finish_game" onclick="location.href ='/'">Finish Game</button>
            <button type="button" id="continue_game">Continue Game</button>
        </div>
    </div>
{% endblock %}


<script>
    let points = document.getElementById("points");
    let undoButton = document.getElementById("undoButton");
    if(points.innerHTML === 0)
    {
        undoButton.setAttribute('disabled', '');
    }
    else
    {
        undoButton.removeAttribute('disabled');
    }

    function setMultipleValue(value)
    {
        switch (value) {
            case 1:
                setMultiplierOfThrow(0,'doubleOption');
                setMultiplierOfThrow(0,'tripleOption');
                break;
            case 2:
                setMultiplierOfThrow(1,'doubleOption');
                setMultiplierOfThrow(0,'tripleOption');
                break;
            case 3:
                setMultiplierOfThrow(0,'doubleOption');
                setMultiplierOfThrow(1,'tripleOption');
                break;
        }
    }

    function setMultiplierOfThrow(param, className) {
        var list = document.getElementsByClassName(className);
        var n;
        var listLength = list.length;

        //there is no 75 points available
        if (param === 1 && className === 'tripleOption') {
            listLength = listLength - 1;
        }

        for (n = 0; n < listLength; ++n) {
            list[n].value = param;
        }
    }

    //pop-up
    let modal = document.getElementById("myModal");
    let continueGameButton = document.getElementById("continue_game");
    let successMessage = document.getElementsByClassName("success-message")[0];

    {% for success in app.flashes('success') %}
        modal.style.display = "block";
        successMessage.innerHTML = '{{ success }}';
    {% endfor %}

    continueGameButton.onclick = function() {
        modal.style.display = "none";
    }

</script>